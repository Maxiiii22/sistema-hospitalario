{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://use.hugeicons.com/font/icons.css" />
    <link rel="stylesheet" href="{% static 'estilos/styles_jefeEnfermeria.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script> {# jQuery (requerido por Toastr.js y DAL) #}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />  {# Toastr CSS: Estilos para mostrar notificaciones tipo toast  #}    
    <title>Ficha de Hospitalizacion</title>
</head>
<body>
    <main class="container-detalles-usuario">
        <div class="box-form-detalles-usuario">
            <h2 class="title-ficha">Ficha de la hospitalizacion del paciente {{hospitalizacion.paciente.persona.get_full_name}} - DNI: {{hospitalizacion.paciente.persona.dni}}. {% if hospitalizacion.paciente.responsable %} Responsable a cargo: {{hospitalizacion.paciente.responsable.adulto.persona.get_full_name}} (DNI: {{hospitalizacion.paciente.responsable.adulto.persona.dni}}). Parentesco con el menor: {{hospitalizacion.paciente.responsable.get_parentesco_display}} {% endif %}</h2>  
            <div class="box-datos">
                <div class="secciones">
                    <div class="datos-personales">
                        <span class="titulo">Datos personales</span>
                        <div class="campos">
                            <div class="campo-input">
                                <label>DNI:</label>
                                <input type="text" value="{{hospitalizacion.paciente.persona.dni}}" readonly>
                            </div>
                                
                            <div class="campo-input">
                                <label>Nombre:</label>
                                <input type="text" value="{{hospitalizacion.paciente.persona.first_name}}" readonly>
                            </div>

                            <div class="campo-input">
                                <label>Apellido:</label>
                                <input type="text" value="{{hospitalizacion.paciente.persona.last_name}}" readonly>
                            </div>

                            <div class="campo-input">
                                <label>Sexo:</label>
                                <input type="text" value="{{hospitalizacion.paciente.persona.get_sexo_display}}" readonly>
                            </div>

                            <div class="campo-input">
                                <label>Fecha nacimiento:</label>
                                <input type="text" value="{{hospitalizacion.paciente.persona.fecha_nacimiento|date:'d-m-Y'}}" readonly>
                            </div>     

                            <div class="campo-input">
                                <label>Fecha de registro:</label>
                                <input type="text" readonly value="{{hospitalizacion.paciente.persona.date_joined|date:'d-m-Y H:i A'}}">
                            </div>                                                   
                    </div>
                </div>
            </div>

            <div class="secciones">
                <div class="datos-personales">
                    <div class="box-header-datos">
                        <span class="titulo">Informacion de la Hospitalizacion:</span>   
                    </div>                           
                    <div class="box-asignacion">
                        <div class="asignacion-header">
                            <div class="asignacion-item">
                                <span><strong>Durante su estancia, ocupó: {{hospitalizacion.lugar.nombre}} - Piso: {{hospitalizacion.lugar.piso}} - N° Sala: {{hospitalizacion.lugar.sala}}</strong></span>
                            </div>
                            <div class="asignacion-item">
                                <span><strong>Médico hospitalario asignado: {{medicoAsignado.medico.persona.get_full_name}} - Matricula: {{medicoAsignado.medico.numero_matricula}}</strong></span>                                  
                            </div>
                            <div class="asignacion-item">
                                <span><strong>Fecha de Ingreso: </strong>{{hospitalizacion.fecha_ingreso|date:"d-m-Y"}}</span>
                            </div>
                            <div class="asignacion-item">
                                <span><strong>Historial de Notas de Enfermería:</strong></span>
                                <a href="{% url 'notasEnfermeria-jefe-enfermeria' hospitalizacion.id %} "class="btn-masDetalles" id=""><i class="hgi hgi-stroke hgi-file-view"></i> Ver Notas de Enfermería</a>
                            </div>                            
                            <div class="asignacion-item box-evaluacion-clinica">
                                <div class="asignacion-evaluacion-clinica">
                                    <span><strong>Alta Médica:</strong></span>
                                </div>
                                <div class="form-evaluaciones-clinicas form-alta-medica">
                                    <div class="campo-evaluaciones-clinicas"> 
                                        <label>Fecha de Alta Médica:</label>
                                        <textarea id="textarea_fechayhorario" readonly>{{alta.fecha_alta}}</textarea>                                                                                                                                             
                                    </div>
                                    <div class="campo-evaluaciones-clinicas">                                               
                                        <label>Diagnostico Principal:</label>   
                                        <textarea readonly>{{alta.diagnostico_principal}}</textarea>                                                                                                                                             
                                    </div>
                                    <div class="campo-evaluaciones-clinicas">                                               
                                        <label>Diagnostico Secundario:</label>   
                                        <textarea readonly>{{alta.diagnosticos_secundarios}}</textarea>                                                                                                                                             
                                    </div>
                                    <div class="campo-evaluaciones-clinicas">                                               
                                        <label>Tratamiento Realizado:</label>   
                                        <textarea readonly>{{alta.tratamiento_realizado}}</textarea>                                                                                                                                             
                                    </div>
                                    <div class="campo-evaluaciones-clinicas">                                               
                                        <label>Indicaciones Post Alta:</label>   
                                        <textarea readonly>{{alta.indicaciones_post_alta}}</textarea>                                                                                                                                             
                                    </div>
                                </div>                                     
                            </div>

                            <div class="asignacion-item box-evaluacion-clinica">
                                <div class="asignacion-evaluacion-clinica">
                                    <span><strong>Evaluación Médica:</strong></span>                                    
                                </div>
                                {% for formReadOnly in formularios_evaluacion %}
                                    <div class="form-evaluaciones-clinicas evaluacion-item" data-index="{{forloop.counter0}}" {% if forloop.counter0 != 0 %} style="display:none;"{% endif %}>
                                        <div class="campo-evaluaciones-clinicas"> 
                                            {% if ultima_observacion.pk == formReadOnly.instance.pk %}
                                                <label>Última actualización:</label>
                                            {% else %}
                                                <label>Subido el:</label>
                                            {% endif %}
                                            <textarea id="textarea_fechayhorario" readonly>{{formReadOnly.instance.fecha_y_horario}}</textarea>                                                                                                                                             
                                        </div>
                                        <div class="campo-evaluaciones-clinicas">                                               
                                            {{formReadOnly.motivo.label_tag}}   
                                            {{formReadOnly.motivo}}   
                                        </div>
                                        <div class="campo-evaluaciones-clinicas">
                                            {{formReadOnly.diagnostico.label_tag}}   
                                            {{formReadOnly.diagnostico}}   
                                        </div>
                                        <div class="campo-evaluaciones-clinicas">
                                            {{formReadOnly.evolucion_clinica.label_tag}}   
                                            {{formReadOnly.evolucion_clinica}}   
                                        </div>
                                        <div class="campo-evaluaciones-clinicas">
                                            {{formReadOnly.indicaciones.label_tag}}   
                                            {{formReadOnly.indicaciones}}   
                                        </div>
                                    </div>
                                {% endfor %}
                                {% if formularios_evaluacion|length > 1 %}
                                    <button id="btnVerAnterior" class="btn-masDetalles">Ver evaluación anterior</button>
                                    <button id="btnOcultarUna" class="btn-masDetalles" style="display:none;">Ocultar evaluación</button>
                                {% endif %}                                        
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>                
    </main>


    <script src="{% static 'js/jefeEnfermeria.js' %}"   ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>  {# Toastr JS: Biblioteca para mostrar notificaciones tipo toast #}

    {% if request.session.sinAsignacion %}
    <script>
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "timeOut": "0",   // Mensaje persistente
            "extendedTimeOut": "0",
            "tapToDismiss": false
        };
        toastr.info("No se ha registrado ninguna asignación para este usuario. Por favor, contacta con administración para resolverlo.");
    </script>    
    {% elif request.session.dia_no_laborable %}
    <script>
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "timeOut": "0",   // Mensaje persistente
            "extendedTimeOut": "0",
            "tapToDismiss": false
        };
        toastr.info("Advertencia: La fecha actual no corresponde a su dia laborable asignado.");
    </script>    
    {% elif request.session.fuera_de_turno %}
    <script>
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "timeOut": "0",   // Mensaje persistente
            "extendedTimeOut": "0",
            "tapToDismiss": false
        };
        toastr.info("Finalizó su horario. Cierre sesión para finalizar el día.");
    </script>
    {% endif %}
    {% if messages %}
        <script>
            {% for message in messages %}
                toastr.options = {
                "closeButton": true,
                "progressBar": true,
                "timeOut": "5000"
                };
                toastr["{{ message.tags|default:'info' }}"]("{{ message|escapejs }}");
            {% endfor %}
        </script>
    {% endif %}    

</body>
</html>